---

- set_fact:
    _directory: '{{ unraid.homelab_dir }}/docker_webui_url'
    _patch_file: docker-webui-url.patch

- name: 'docker_webui_url: Create directory for persistent files'
  ansible.builtin.file:
    path: '{{ _directory }}'
    state: directory

- name: 'docker_webui_url: Copy file to persistent storage'
  ansible.builtin.copy:
    src: '{{ role_path }}/_docker_webui_url/{{ _patch_file }}'
    dest: '{{ _directory }}/{{ _patch_file }}'
    force: true

- include_tasks: '{{ playbook_dir }}/dry/unraid/boot.yml'
  vars:
    name: Docker WebUI URL
    script: |
      fromdos < '{{ _directory }}/{{ _patch_file }}' > '{{ unraid.boot_tmp_dir }}'/{{ _patch_file }}
      patch --verbose /usr/local/emhttp/plugins/dynamix.docker.manager/include/DockerClient.php '{{ unraid.boot_tmp_dir }}'/{{ _patch_file }}
